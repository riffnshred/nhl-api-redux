TEAMS_ID = {
    "Devils": 1,
    "Red Wings": 17,
    "Bruins": 6,
    "Jets": 52,
    "Sharks": 28,
    "Penguins": 5,
    "Lightning": 14,
    "Flyers": 4,
    "Senators": 9,
    "Maple Leafs": 10,
    "Sabres": 7,
    "Blues": 19,
    "Hurricanes": 12,
    "Coyotes": 53,
    "Flames": 20,
    "Canadiens": 8,
    "Capitals": 15,
    "Kings": 26,
    "Canucks": 23,
    "Avalanche": 21,
    "Predators": 18,
    "Ducks": 24,
    "Golden Knights": 54,
    "Islanders": 2,
    "Kraken": 55,
    "Stars": 25,
    "Wild": 30,
    "Oilers": 22,
    "Blackhawks": 16,
    "Rangers": 3,
    "Blue Jackets": 29,
    "Panthers": 13
}

TEAMS_INFO={
   "1":{
      "franchiseId":23,
      "fullName":"New Jersey Devils",
      "leagueId":133,
      "rawTricode":"NJD",
      "triCode":"NJD",
      "name":"Devils",
      "location":"New Jersey"
   },
   "17":{
      "franchiseId":12,
      "fullName":"Detroit Red Wings",
      "leagueId":133,
      "rawTricode":"DET",
      "triCode":"DET",
      "name":"Red Wings",
      "location":"Detroit"
   },
   "6":{
      "franchiseId":6,
      "fullName":"Boston Bruins",
      "leagueId":133,
      "rawTricode":"BOS",
      "triCode":"BOS",
      "name":"Bruins",
      "location":"Boston"
   },
   "52":{
      "franchiseId":35,
      "fullName":"Winnipeg Jets",
      "leagueId":133,
      "rawTricode":"WPG",
      "triCode":"WPG",
      "name":"Jets",
      "location":"Winnipeg"
   },
   "28":{
      "franchiseId":29,
      "fullName":"San Jose Sharks",
      "leagueId":133,
      "rawTricode":"SJS",
      "triCode":"SJS",
      "name":"Sharks",
      "location":"San Jose"
   },
   "5":{
      "franchiseId":17,
      "fullName":"Pittsburgh Penguins",
      "leagueId":133,
      "rawTricode":"PIT",
      "triCode":"PIT",
      "name":"Penguins",
      "location":"Pittsburgh"
   },
   "14":{
      "franchiseId":31,
      "fullName":"Tampa Bay Lightning",
      "leagueId":133,
      "rawTricode":"TBL",
      "triCode":"TBL",
      "name":"Lightning",
      "location":"Tampa Bay"
   },
   "4":{
      "franchiseId":16,
      "fullName":"Philadelphia Flyers",
      "leagueId":133,
      "rawTricode":"PHI",
      "triCode":"PHI",
      "name":"Flyers",
      "location":"Philadelphia"
   },
   "9":{
      "franchiseId":30,
      "fullName":"Ottawa Senators",
      "leagueId":133,
      "rawTricode":"OTT",
      "triCode":"OTT",
      "name":"Senators",
      "location":"Ottawa"
   },
   "10":{
      "franchiseId":5,
      "fullName":"Toronto Maple Leafs",
      "leagueId":133,
      "rawTricode":"TOR",
      "triCode":"TOR",
      "name":"Maple Leafs",
      "location":"Toronto"
   },
   "7":{
      "franchiseId":19,
      "fullName":"Buffalo Sabres",
      "leagueId":133,
      "rawTricode":"BUF",
      "triCode":"BUF",
      "name":"Sabres",
      "location":"Buffalo"
   },
   "19":{
      "franchiseId":18,
      "fullName":"St. Louis Blues",
      "leagueId":133,
      "rawTricode":"STL",
      "triCode":"STL",
      "name":"Blues",
      "location":"St. Louis"
   },
   "12":{
      "franchiseId":26,
      "fullName":"Carolina Hurricanes",
      "leagueId":133,
      "rawTricode":"CAR",
      "triCode":"CAR",
      "name":"Hurricanes",
      "location":"Carolina"
   },
   "53":{
      "franchiseId":28,
      "fullName":"Arizona Coyotes",
      "leagueId":133,
      "rawTricode":"ARI",
      "triCode":"ARI",
      "name":"Coyotes",
      "location":"Arizona"
   },
   "20":{
      "franchiseId":21,
      "fullName":"Calgary Flames",
      "leagueId":133,
      "rawTricode":"CGY",
      "triCode":"CGY",
      "name":"Flames",
      "location":"Calgary"
   },
   "8":{
      "franchiseId":1,
      "fullName":"Montréal Canadiens",
      "leagueId":133,
      "rawTricode":"MTL",
      "triCode":"MTL",
      "name":"Canadiens",
      "location":"Montréal"
   },
   "15":{
      "franchiseId":24,
      "fullName":"Washington Capitals",
      "leagueId":133,
      "rawTricode":"WSH",
      "triCode":"WSH",
      "name":"Capitals",
      "location":"Washington"
   },
   "26":{
      "franchiseId":14,
      "fullName":"Los Angeles Kings",
      "leagueId":133,
      "rawTricode":"LAK",
      "triCode":"LAK",
      "name":"Kings",
      "location":"Los Angeles"
   },
   "23":{
      "franchiseId":20,
      "fullName":"Vancouver Canucks",
      "leagueId":133,
      "rawTricode":"VAN",
      "triCode":"VAN",
      "name":"Canucks",
      "location":"Vancouver"
   },
   "21":{
      "franchiseId":27,
      "fullName":"Colorado Avalanche",
      "leagueId":133,
      "rawTricode":"COL",
      "triCode":"COL",
      "name":"Avalanche",
      "location":"Colorado"
   },
   "18":{
      "franchiseId":34,
      "fullName":"Nashville Predators",
      "leagueId":133,
      "rawTricode":"NSH",
      "triCode":"NSH",
      "name":"Predators",
      "location":"Nashville"
   },
   "24":{
      "franchiseId":32,
      "fullName":"Anaheim Ducks",
      "leagueId":133,
      "rawTricode":"ANA",
      "triCode":"ANA",
      "name":"Ducks",
      "location":"Anaheim"
   },
   "54":{
      "franchiseId":38,
      "fullName":"Vegas Golden Knights",
      "leagueId":133,
      "rawTricode":"VGK",
      "triCode":"VGK",
      "name":"Golden Knights",
      "location":"Vegas"
   },
   "2":{
      "franchiseId":22,
      "fullName":"New York Islanders",
      "leagueId":133,
      "rawTricode":"NYI",
      "triCode":"NYI",
      "name":"Islanders",
      "location":"New York"
   },
   "55":{
      "franchiseId":39,
      "fullName":"Seattle Kraken",
      "leagueId":133,
      "rawTricode":"SEA",
      "triCode":"SEA",
      "name":"Kraken",
      "location":"Seattle"
   },
   "25":{
      "franchiseId":15,
      "fullName":"Dallas Stars",
      "leagueId":133,
      "rawTricode":"DAL",
      "triCode":"DAL",
      "name":"Stars",
      "location":"Dallas"
   },
   "30":{
      "franchiseId":37,
      "fullName":"Minnesota Wild",
      "leagueId":133,
      "rawTricode":"MIN",
      "triCode":"MIN",
      "name":"Wild",
      "location":"Minnesota"
   },
   "22":{
      "franchiseId":25,
      "fullName":"Edmonton Oilers",
      "leagueId":133,
      "rawTricode":"EDM",
      "triCode":"EDM",
      "name":"Oilers",
      "location":"Edmonton"
   },
   "16":{
      "franchiseId":11,
      "fullName":"Chicago Blackhawks",
      "leagueId":133,
      "rawTricode":"CHI",
      "triCode":"CHI",
      "name":"Blackhawks",
      "location":"Chicago"
   },
   "3":{
      "franchiseId":10,
      "fullName":"New York Rangers",
      "leagueId":133,
      "rawTricode":"NYR",
      "triCode":"NYR",
      "name":"Rangers",
      "location":"New York"
   },
   "29":{
      "franchiseId":36,
      "fullName":"Columbus Blue Jackets",
      "leagueId":133,
      "rawTricode":"CBJ",
      "triCode":"CBJ",
      "name":"Blue Jackets",
      "location":"Columbus"
   },
   "13":{
      "franchiseId":33,
      "fullName":"Florida Panthers",
      "leagueId":133,
      "rawTricode":"FLA",
      "triCode":"FLA",
      "name":"Panthers",
      "location":"Florida"
   }
}

import requests
from datetime import datetime
from .domains import BASEWEB
from .status import game_schedule_is_irregular, game_is_scheduled, game_is_pre_game, game_is_over, game_is_critical, game_is_live

def find_previous_and_next_games(season_schedule):
   current_datetime = datetime.strptime(datetime.today().strftime('%Y-%m-%d'), "%Y-%m-%d")
   previous_game = None
   next_game = None

   for i, game in enumerate(season_schedule):
      game_datetime = datetime.strptime(game['gameDate'], "%Y-%m-%d")
      if game_datetime >= current_datetime:
         if i > 0:
            if game_is_over(game["gameState"]):
               previous_game = season_schedule[i]
            else:
               previous_game = season_schedule[i - 1]
         if i < len(season_schedule) - 1:
            if game_is_pre_game(game["gameState"]) and game_is_scheduled(game["gameScheduleState"]):
               next_game = season_schedule[i]
            else:
               next_game = season_schedule[i + 1]
         break
      
   return previous_game, next_game

class Team:
   def __init__(self, name):
      self.id = TEAMS_ID[name]
      self.info = TEAMS_INFO[str(self.id)]
      self.abbrev = self.info["triCode"]
      self.name = self.info["name"]
      self.full_name = self.info["fullName"]
      self.location = self.info["location"]
      self.season_schedule = self.update_season_schedule()
      self.previous_game, self.next_game = find_previous_and_next_games(self.season_schedule["games"])
      
   def roster(self):
      response = requests.get(f"{BASEWEB}/roster/{self.abbrev}/current")
      self.data = response.json()
      return self.data

   def update_season_schedule(self):
      response = requests.get(f"{BASEWEB}/club-schedule-season/{self.abbrev}/now")
      
      self.data = response.json()
      return self.data
